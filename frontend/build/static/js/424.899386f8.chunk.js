"use strict";(self.webpackChunkcasecon_frontend=self.webpackChunkcasecon_frontend||[]).push([[424],{424:(e,r,s)=>{s.r(r),s.d(r,{default:()=>d});var n=s(43),t=s(32),a=s(636),l=s(339),i=s(768),c=s(240),o=s(579);const d=function(e){let{onStatusUpdate:r}=e;const{bucaText:s,bucaRows:d,setBucaText:h,setBucaRows:u,clearBucaRows:g,updateBucaRow:x,lastUpdated:m}=(0,t.i)(),[b,p]=(0,n.useState)(!1),[v,f]=(0,n.useState)(""),[w,j]=(0,n.useState)(!1),[N,y]=(0,n.useState)([]),[C,I]=(0,n.useState)(!1),[S,A]=(0,n.useState)(null);(0,n.useEffect)(()=>{(null===d||void 0===d?void 0:d.length)>0&&r&&r(`Loaded ${d.length} BUCA records`)},[d,r]);const U=(0,a.W)(),B=(e,r)=>{const n=d.map((s,n)=>n===e?{...s,caregiver:r,caregivers:[r]}:s);let a=s;if("string"===typeof s&&s.length>0){const t=s.includes("\r\n")?"\r\n":"\n",l=s.split(/\r?\n/),i=/(ESTCaregiver:\s*)([^\n\r]*)/i,c=n[e]&&n[e].caseNumber;let o=-1;c&&(o=l.findIndex(e=>e.includes(c))),-1!==o?(l[o]=l[o].replace(i,`$1${r}`),a=l.join(t)):null!=l[e]&&(l[e]=l[e].replace(i,`$1${r}`),a=l.join(t))}u(n),t.i.getState().setBucaRows(n),"string"===typeof a&&(h(a),t.i.getState().setBucaText(a));try{U.publish("buca",{rows:n,updatedAt:(new Date).toISOString()})}catch(i){console.warn("Exchange publish failed:",i)}const l=N.findIndex(r=>r.rowIndex===e)+1;if(l<N.length){const e=N[l];A({...e,rowIndex:e.rowIndex})}else I(!1),A(null),y([])};return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"bg-gray-50 border rounded p-4 mb-4",children:[(0,o.jsx)("label",{className:"block font-semibold mb-2",children:"Paste BUCA data here (One entry per line)"}),(0,o.jsx)("textarea",{className:"w-full h-64 p-2 border rounded font-mono text-sm",placeholder:"Paste BUCA data here...",value:s,onChange:e=>{const r=e.target.value;h(r),t.i.getState().setBucaText(r)},disabled:b})]}),(0,o.jsxs)("div",{className:"flex gap-4 mb-4 items-center",children:[(0,o.jsx)("button",{className:"bg-orange-500 text-white px-6 py-2 rounded font-semibold hover:bg-orange-600",onClick:async()=>{if(s.trim()){p(!0),f("");try{var e;const t=await i.F5(s);if(null===t||void 0===t||null===(e=t.rows)||void 0===e||!e.length)throw new Error("No valid data found in BUCA input");const a=[...t.rows].sort((e,r)=>(e.client||"").localeCompare(r.client||""));let l={clients:{},caregivers:{}};try{l=await i.I2(a)}catch(n){console.warn("BUCA UID ensure failed, proceeding without enrichment",n)}const c=a.map(e=>{var r;return{...e,clientUID:(null===(r=l.clients)||void 0===r?void 0:r[String(e.client||"").trim()])||e.clientUID||"",caregiverUID:(r=>{const s=Array.isArray(e.caregivers)&&e.caregivers.length>0?e.caregivers[0]:e.caregiver||"";return(null===(r=l.caregivers)||void 0===r?void 0:r[String(s).trim()])||e.caregiverUID||""})()}});u(c),console.log("Publishing to exchange store:",{rows:c,timestamp:(new Date).toISOString()}),U.publish("buca",{rows:c,uidSynced:!0,timestamp:(new Date).toISOString()}),r&&r(`Processed ${c.length} BUCA records`)}catch(v){console.error("Error processing BUCA data:",v),f(v.message||"Failed to process BUCA data"),r&&r("Error processing BUCA data")}finally{p(!1)}}else f("Please enter BUCA data")},disabled:b,children:"Process"}),(0,o.jsx)("button",{className:"bg-gray-300 text-gray-800 px-6 py-2 rounded font-semibold hover:bg-gray-400",onClick:()=>{g(),f(""),y([]),I(!1),A(null),r&&r("BUCA data cleared")},children:"Clear"}),(0,o.jsx)("button",{className:"bg-orange-400 text-white px-6 py-2 rounded font-semibold hover:bg-orange-500",onClick:()=>{const e=(0,c.uT)(d);if(!Array.isArray(e)||0===e.length)return f("No rows with multiple caregivers found."),I(!1),A(null),void y([]);const r=e.map(e=>{const r=d.findIndex(r=>r.client===e.client&&r.caseNumber===e.caseNumber);return{...e,rowIndex:r}}).filter(e=>-1!==e.rowIndex);if(0===r.length)return f("Could not locate rows in the current data."),I(!1),A(null),void y([]);y(r),A(r[0]),I(!0),f("")},disabled:0===(0,c.uT)(d).length,children:"IDENTIFY CG"}),(0,o.jsxs)("label",{className:"flex items-center gap-2 ml-2 text-sm",children:[(0,o.jsx)("input",{type:"checkbox",checked:w,onChange:e=>j(e.target.checked)}),(0,o.jsx)("span",{children:"Show UIDs"})]})]}),v&&(0,o.jsx)("div",{className:"text-red-600 mb-2",children:v}),(0,o.jsx)("div",{className:"overflow-x-auto border rounded bg-white mb-4 max-h-[350px] overflow-y-auto",children:(0,o.jsxs)("table",{className:"min-w-full text-sm",children:[(0,o.jsx)("thead",{className:"bg-gray-200",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"p-2 border font-bold",children:"#"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Client"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Caregiver"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Case Number"})]})}),(0,o.jsx)("tbody",{children:[...d].sort((e,r)=>(e.client||"").localeCompare(r.client||"")).map((e,r)=>(0,o.jsxs)("tr",{children:[(0,o.jsx)(l.A,{children:r+1}),(0,o.jsxs)(l.A,{children:[e.client,w&&(0,o.jsxs)("span",{className:"text-gray-500 text-xs ml-2",children:["[",e.clientUID||e.client_uid||e.clientId||e.client_id||"","]"]})]}),(0,o.jsxs)(l.A,{children:[Array.isArray(e.caregivers)?e.caregivers.join(", "):e.caregiver||"",w&&(0,o.jsxs)("span",{className:"text-gray-500 text-xs ml-2",children:["[",e.caregiverUID||e.caregiver_uid||e.caregiverId||e.caregiver_id||"","]"]})]}),(0,o.jsx)(l.A,{children:"string"===typeof e.caseNumber?e.caseNumber.replace(/\s*Date:.*$/i,"").trim():e.caseNumber})]},r))})]})}),C&&S&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-lg p-6 min-w-[340px] max-w-[90vw]",children:[(0,o.jsx)("h2",{className:"text-lg font-bold mb-2",children:"Resolve Multiple Caregivers"}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"Client:"})," ",S.client]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"Case #:"})," ",S.caseNumber]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("span",{className:"font-semibold",children:"Date:"})," ",S.date]})]}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("div",{className:"font-semibold mb-1",children:"Select the correct caregiver:"}),(0,o.jsx)("div",{className:"flex flex-col gap-2",children:(Array.isArray(S.caregivers)?S.caregivers:"string"===typeof S.caregiver?S.caregiver.split(",").map(e=>e.trim()).filter(Boolean):[]).map((e,r)=>(0,o.jsx)("button",{className:"bg-blue-500 hover:bg-blue-600 text-white rounded px-4 py-2 text-left",onClick:()=>{console.log("Selected caregiver:",e,"for row index:",S.rowIndex),B(S.rowIndex,e)},children:e},r))})]}),(0,o.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,o.jsx)("button",{className:"bg-gray-300 hover:bg-gray-400 text-gray-800 rounded px-4 py-2",onClick:()=>{I(!1),A(null)},children:"Cancel"}),(0,o.jsx)("button",{className:"bg-orange-400 hover:bg-orange-500 text-white rounded px-4 py-2",onClick:()=>{S.caregivers&&S.caregivers.length>0?B(S.rowIndex,S.caregivers[0]):(I(!1),A(null))},children:"Skip"})]})]})})]})}},636:(e,r,s)=>{s.d(r,{W:()=>n});const n=(0,s(131).v)((e,r)=>({channels:{buca:null,jovie:null,uids:null,storage:null},publish:(r,s)=>{e(e=>({channels:{...e.channels,[r]:{...e.channels[r],...s,timestamp:(new Date).toISOString()}}}))},subscribe:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>e;return s=>n.subscribe(n=>{const t=n.channels[e];t&&s(r(t),t)},r)},clearChannel:r=>{e(e=>({channels:{...e.channels,[r]:null}}))},getChannelData:e=>r().channels[e]}));"undefined"!==typeof window&&(window.exchangeStore=n)}}]);
//# sourceMappingURL=424.899386f8.chunk.js.map
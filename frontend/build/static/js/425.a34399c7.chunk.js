"use strict";(self.webpackChunkcasecon_frontend=self.webpackChunkcasecon_frontend||[]).push([[425],{425:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var s=n(43),i=n(579);const o=1,a=(()=>{try{if("undefined"!==typeof window&&window.CASECON_API_BASE)return String(window.CASECON_API_BASE).replace(/\/$/,"");if("undefined"!==typeof window&&window.localStorage){const e=window.localStorage.getItem("casecon_api_base");if(e)return String(e).replace(/\/$/,"")}const e="undefined"!==typeof process?{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE:"http://localhost:5000",REACT_APP_ENABLE_ANALYTICS:"false",REACT_APP_ENABLE_LOGGING:"true",REACT_APP_UID_API_URL:"http://localhost:5000/uids"}:{},t=e.REACT_APP_API_BASE;if(t&&"string"===typeof t)return t.replace(/\/$/,"");const n=e.REACT_APP_UID_API_URL;if(n&&"string"===typeof n)try{const e=new URL(n);return`${e.protocol}//${e.host}`}catch{}}catch{}return""})();try{console.info("[AdminDesk] API_BASE =",a||"(same-origin)")}catch{}function r(e,t){const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=e,document.body.appendChild(i),i.click(),URL.revokeObjectURL(s),i.remove()}function l(){const e=!1,t={padding:"6px 10px",border:"1px solid #d0d7de",borderRadius:6,background:"#f6f8fa",color:"#24292f",cursor:"pointer"},[n,l]=(0,s.useState)(!1),[c,d]=(0,s.useState)([]),[h,p]=(0,s.useState)(!1),[u,y]=(0,s.useState)(null),[f,g]=(0,s.useState)(!1),[x,w]=(0,s.useState)({name:"",includeFiles:!1,makePublic:!1,comment:""}),[m,C]=(0,s.useState)(null),[S,b]=(0,s.useState)(""),[A,j]=(0,s.useState)(""),[v,_]=(0,s.useState)("checking"),[E,k]=(0,s.useState)(a),[P,R]=(0,s.useState)(!1),[T,I]=(0,s.useState)(a);async function L(){try{const e=a||"",t=await fetch(`${e}/api/snapshots`,{method:"GET"});_(t.ok?"connected":"unavailable")}catch{_("unavailable")}}(0,s.useEffect)(()=>{try{j(N())}catch{}},[]),(0,s.useEffect)(()=>{f&&!x.name&&w(e=>({...e,name:N()}))},[f]),(0,s.useEffect)(()=>{_("checking"),L()},[]);const O=(0,s.useMemo)(()=>{const e="undefined"!==typeof process&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE:"http://localhost:5000",REACT_APP_ENABLE_ANALYTICS:"false",REACT_APP_ENABLE_LOGGING:"true",REACT_APP_UID_API_URL:"http://localhost:5000/uids"}&&{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE:"http://localhost:5000",REACT_APP_ENABLE_ANALYTICS:"false",REACT_APP_ENABLE_LOGGING:"true",REACT_APP_UID_API_URL:"http://localhost:5000/uids"}.REACT_APP_VERSION,t=window.__APP_VERSION||(window.CaseCon&&"function"===typeof window.CaseCon.getAppVersion?window.CaseCon.getAppVersion():void 0);return e||t||"dev-unknown"},[]),B=(0,s.useMemo)(()=>window.CaseCon&&window.CaseCon.username||window.__USER_NAME||"unknown",[]);function N(){const e=new Date,t=e=>String(e).padStart(2,"0");return`Recon-${t(e.getMonth()+1)}-${t(e.getDate())}-${e.getFullYear()}- ${t(e.getHours())}:${t(e.getMinutes())}`}function U(){const e=window.__CASECON_TEMP_UIDS;if(e)try{if(e instanceof Map)return Object.fromEntries(e.entries());if("object"===typeof e)return e}catch{}}async function $(e){const t=await async function(){const e=window.CaseCon&&Array.isArray(window.CaseCon.snapshotProviders)?window.CaseCon.snapshotProviders:[],t=await Promise.allSettled(e.map(e=>Promise.resolve().then(()=>e()))),n={};return t.forEach(e=>{"fulfilled"===e.status&&e.value&&"object"===typeof e.value&&Object.assign(n,e.value)}),n}(),{ui:n,temporary:s}=await async function(){if(window.CaseCon&&"function"===typeof window.CaseCon.uiProvider)try{return await window.CaseCon.uiProvider()}catch{}let e;try{const t=document.querySelector('[role="tab"][aria-selected="true"]');if(t){const n=t.getAttribute("data-tab-index")||t.getAttribute("data-index");e=n?Number(n):void 0}}catch{}return{ui:{activeTab:e},temporary:{tempUids:U()}}}(),i=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),a=(new Date).toISOString(),r={id:i,name:e||N(),createdBy:B,createdAt:a,appVersion:O,schemaVersion:o,stores:t,ui:n||{},temporary:s||{},uploads:{items:[]}},l=JSON.stringify(r),c=await async function(e){if(window.crypto&&window.crypto.subtle){const t=(new TextEncoder).encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return("00000000"+(t>>>0).toString(16)).slice(-8)}(l),d=new Blob([l]).size;return{...r,meta:{sizeBytes:d,checksum:`sha256:${c}`}}}async function D(e){l(!1),b("Collecting snapshot...");try{const t=`${N()} [${e}]`,n=await $(t);await V(n,!1),j("")}catch(t){console.error(t),y(String(t.message||t))}finally{b("")}}async function V(e,t){try{p(!0);const n=await fetch(`${a}/api/snapshots`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,snapshot:e,includeFiles:!!t})});if(!n.ok){const e=await async function(e){const t=await e.text();try{return JSON.parse(t)}catch{return{ok:!1,raw:t}}}(n),t=e&&(e.error||e.message||e.raw);return y(`Server save failed (${n.status}): ${t||n.statusText}`),{ok:!1,server:!0}}const s=await n.json();return await z(),F("Snapshot saved on server"+(s.id?" (#"+s.id+")":"")),{ok:!0,server:!0,id:s.id}}catch(n){return console.warn("Server save unavailable; falling back to local download.",n),r(`${e.name}.casecon.snapshot.json`,e),F("Server unavailable; downloaded snapshot locally"),{ok:!0,server:!1}}finally{p(!1)}}async function z(){try{p(!0);const e=await fetch(`${a}/api/snapshots`);if(!e.ok)throw new Error("List unavailable");const t=await e.json();d(Array.isArray(t.snapshots)?t.snapshots:[])}catch(e){d([])}finally{p(!1)}}async function W(e,t){let n=t;try{if(!n){const t=await fetch(`${a}/api/snapshots/${encodeURIComponent(e)}`);if(!t.ok)throw new Error("Load failed");n=await t.json()}const t=function(e){const t=[];return e&&"object"===typeof e||t.push("Invalid snapshot object"),e.schemaVersion||t.push("Missing schemaVersion"),e.schemaVersion&&e.schemaVersion!==o&&t.push(`schemaVersion mismatch: app=${o} file=${e.schemaVersion}`),e.appVersion||t.push("Missing appVersion"),{ok:0===t.length,errs:t}}(n);if(!t.ok&&!window.confirm(`Snapshot validation warnings: ${t.errs.join("; ")}. Continue anyway?`))return;await async function(e){b("Restoring snapshot \u2014 please wait...");try{if(window.CaseCon&&"function"===typeof window.CaseCon.applySnapshot)await window.CaseCon.applySnapshot(e);else{const t=new CustomEvent("casecon:apply-snapshot",{detail:{snapshot:e}});window.dispatchEvent(t)}F("Snapshot restored")}catch(t){console.error("Apply snapshot error",t),y("Apply failed. See console for details.")}finally{b("")}}(n)}catch(s){y("Unable to load/apply snapshot")}}function F(e){try{const t=document.createElement("div");t.textContent=e,t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.background="#111",t.style.color="#fff",t.style.padding="8px 12px",t.style.borderRadius="6px",t.style.zIndex="9999",document.body.appendChild(t),setTimeout(()=>t.remove(),2200)}catch{}}return(0,s.useEffect)(()=>{z()},[]),(0,i.jsxs)("div",{style:{padding:16},children:[(0,i.jsxs)("h2",{style:{fontSize:20,fontWeight:700,display:"flex",alignItems:"center",gap:8},children:["Server",(0,i.jsx)("span",{title:E?`API: ${E}`:"API: same-origin",style:{fontSize:12,padding:"2px 8px",borderRadius:999,background:"connected"===v?"#e6ffed":"checking"===v?"#fffbea":"#ffefef",color:"connected"===v?"#046b1b":"checking"===v?"#896100":"#8b0000",border:"1px solid "+("connected"===v?"#b7f5c4":"checking"===v?"#ffe58f":"#ffc4c4")},children:"Server: "+("connected"===v?"Connected":"checking"===v?"Checking\u2026":"Unavailable")}),(0,i.jsx)("button",{onClick:()=>{_("checking"),L(),z()},style:{...t,fontSize:12,marginLeft:6},title:"Retry connection check",children:"Retry"}),(0,i.jsx)("button",{onClick:()=>{R(e=>!e),I(E||"")},style:{...t,fontSize:12,marginLeft:6},title:"Set API base URL",children:"Set API"})]}),P&&(0,i.jsxs)("div",{style:{display:"flex",gap:6,alignItems:"center",marginBottom:8},children:[(0,i.jsx)("input",{style:{padding:"4px 8px",border:"1px solid #ddd",borderRadius:6,minWidth:260},value:T,placeholder:"http://localhost:5000",onChange:e=>I(e.target.value)}),(0,i.jsx)("button",{style:{...t},onClick:()=>{const e=String(T||"").replace(/\/$/,"");try{window.localStorage&&window.localStorage.setItem("casecon_api_base",e)}catch{}k(e),_("checking"),L(),z()},children:"Apply"}),(0,i.jsx)("button",{style:{...t},onClick:()=>R(!1),children:"Close"})]}),e,S?(0,i.jsx)("div",{style:{margin:"12px 0",padding:8,background:"#eef"},children:S}):null,u?(0,i.jsx)("div",{style:{margin:"12px 0",padding:8,background:"#fee",color:"#900"},children:u}):null,(0,i.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginTop:8,marginBottom:16,alignItems:"center"},children:[(0,i.jsx)("input",{style:{flex:"1 1 260px",minWidth:220,padding:"6px 8px",border:"1px solid #ddd",borderRadius:6},value:A,placeholder:"Snapshot name (optional) e.g. 'post-recon-2025-08-12'",onChange:e=>j(e.target.value)}),(0,i.jsx)("button",{style:{...t},onClick:async function(){l(!0)},title:"Save snapshot with the given name",children:"Save"}),(0,i.jsx)("button",{style:{...t},onClick:()=>g(!0),title:"Open advanced save options",children:"Save As\u2026"})]}),f&&(0,i.jsxs)("div",{style:{border:"1px solid #ddd",padding:12,borderRadius:8,marginBottom:16},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"Save Snapshot"}),(0,i.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,i.jsxs)("label",{children:[(0,i.jsx)("div",{children:"Name"}),(0,i.jsx)("input",{style:{width:"100%"},value:x.name,placeholder:N(),onChange:e=>w(t=>({...t,name:e.target.value}))})]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("input",{type:"checkbox",checked:x.includeFiles,onChange:e=>w(t=>({...t,includeFiles:e.target.checked}))}),"Include attached files (if available)"]}),(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("input",{type:"checkbox",checked:x.makePublic,onChange:e=>w(t=>({...t,makePublic:e.target.checked}))}),"Make public to team (admin-only server setting)"]}),(0,i.jsxs)("label",{children:[(0,i.jsx)("div",{children:"Comment"}),(0,i.jsx)("textarea",{rows:2,style:{width:"100%"},value:x.comment,onChange:e=>w(t=>({...t,comment:e.target.value}))})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{style:{...t},onClick:async function(){b("Collecting snapshot...");try{const e=await $(x.name||N());await V(e,!0===x.includeFiles)}catch(e){console.error(e),y(String(e.message||e))}finally{b(""),g(!1)}},children:"Save"}),(0,i.jsx)("button",{style:{...t},onClick:()=>g(!1),children:"Cancel"})]})]})]}),n&&(0,i.jsx)("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.35)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1100},children:(0,i.jsxs)("div",{style:{background:"#fff",padding:16,borderRadius:8,minWidth:360},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"Select a tag"}),(0,i.jsx)("p",{style:{marginTop:0,color:"#555"},children:"Choose where this Recon save belongs."}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{style:{...t},onClick:()=>D("Atlanta"),children:"Atlanta"}),(0,i.jsx)("button",{style:{...t},onClick:()=>D("Charlotte"),children:"Charlotte"}),(0,i.jsx)("button",{style:{...t},onClick:()=>D("Raleigh"),children:"Raleigh"})]}),(0,i.jsx)("div",{style:{marginTop:12,textAlign:"right"},children:(0,i.jsx)("button",{style:{...t},onClick:()=>l(!1),children:"Cancel"})})]})}),m&&(0,i.jsxs)("div",{style:{border:"1px solid #ddd",padding:12,borderRadius:8,marginBottom:16},children:[(0,i.jsx)("h3",{style:{marginTop:0},children:"Preview Local Snapshot"}),(0,i.jsxs)("div",{style:{fontSize:12,color:"#333",marginBottom:8},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Name:"})," ",m.name," ",(0,i.jsx)("b",{children:"AppVersion:"})," ",m.appVersion," ",(0,i.jsx)("b",{children:"Schema:"})," ",m.schemaVersion]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"CreatedBy:"})," ",m.createdBy," ",(0,i.jsx)("b",{children:"CreatedAt:"})," ",m.createdAt]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("b",{children:"Size:"})," ",m.meta&&m.meta.sizeBytes," ",(0,i.jsx)("b",{children:"Checksum:"})," ",m.meta&&m.meta.checksum]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{style:{...t},onClick:()=>W(void 0,m),children:"Load"}),(0,i.jsx)("button",{style:{...t},onClick:()=>r(`${m.name||"snapshot"}.casecon.snapshot.json`,m),children:"Download"}),(0,i.jsx)("button",{style:{...t},onClick:()=>C(null),children:"Close"})]})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[(0,i.jsx)("h3",{style:{margin:0},children:"Server Snapshots"}),(0,i.jsx)("button",{style:{...t,opacity:h?.6:1},onClick:z,disabled:h,children:"Refresh"})]}),(0,i.jsx)("div",{style:{border:"1px solid #eee",borderRadius:8,overflow:"hidden"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:14},children:[(0,i.jsx)("thead",{style:{background:"#fafafa"},children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:{textAlign:"left",padding:8},children:"Name"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:8},children:"CreatedBy"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:8},children:"CreatedAt"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:8},children:"AppVersion"}),(0,i.jsx)("th",{style:{textAlign:"right",padding:8},children:"Size"}),(0,i.jsx)("th",{style:{textAlign:"left",padding:8},children:"Actions"})]})}),(0,i.jsxs)("tbody",{children:[0===c.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:6,style:{padding:12,color:"#777"},children:"No snapshots on server or server unavailable."})}),c.map(e=>(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{padding:8},children:e.name||e.id}),(0,i.jsx)("td",{style:{padding:8},children:e.createdBy||""}),(0,i.jsx)("td",{style:{padding:8},children:e.createdAt||""}),(0,i.jsx)("td",{style:{padding:8},children:e.appVersion||""}),(0,i.jsx)("td",{style:{padding:8,textAlign:"right"},children:"number"===typeof e.sizeBytes?e.sizeBytes.toLocaleString():""}),(0,i.jsx)("td",{style:{padding:8},children:(0,i.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,i.jsx)("button",{style:{...t},onClick:()=>async function(e){try{const t=await fetch(`${a}/api/snapshots/${encodeURIComponent(e)}`);if(!t.ok)throw new Error("Download failed");const n=await t.json();r(`${n.name||e}.casecon.snapshot.json`,n)}catch(t){y("Unable to download snapshot")}}(e.id),children:"Download"}),(0,i.jsx)("button",{style:{...t},onClick:()=>W(e.id),children:"Load"}),(0,i.jsx)("button",{style:{...t},onClick:()=>C({id:e.id,...e}),children:"Preview"}),(0,i.jsx)("button",{style:{...t},onClick:()=>async function(e){if(window.confirm("Delete snapshot permanently?"))try{if(!(await fetch(`${a}/api/snapshots/${encodeURIComponent(e)}`,{method:"DELETE"})).ok)throw new Error("Delete failed");await z()}catch(t){y("Unable to delete snapshot")}}(e.id),children:"Delete"})]})})]},e.id))]})]})}),(0,i.jsx)("p",{style:{marginTop:12,color:"#666"},children:e})]})}}}]);
//# sourceMappingURL=425.a34399c7.chunk.js.map
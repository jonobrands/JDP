"use strict";(self.webpackChunkcasecon_frontend=self.webpackChunkcasecon_frontend||[]).push([[518],{518:(e,t,r)=>{r.r(t),r.d(t,{default:()=>c});var n=r(43),a=r(339),s=r(326),o=r(579);const c=function(e){let{rows:t=[],onRecon:c,onReport:l,onClear:i,onExport:u}=e;const d=(0,s.A)(e=>e.editedResults),m=(0,s.A)(e=>e.setEditedResult),h=(0,s.A)(e=>e.clearEditedResults),g=(0,s.A)(e=>e.setConfirmation),f=(0,s.A)(e=>e.clearConfirmations),[b,x]=(0,n.useState)(""),p=(0,n.useRef)(null),C=(0,n.useRef)(null),[y,w]=(0,n.useState)(null),v=e=>{try{const t=document.createRange();t.selectNodeContents(e);const r=window.getSelection();r.removeAllRanges(),r.addRange(t)}catch{}},N=e=>{if("string"!==typeof e)return"";const t=e.match(/BUC\s*Case\s*Number\s*:\s*([A-Z0-9-]+)/i);if(t)return t[1].trim();const r=e.match(/(?:^|\s)((?:00[a-zA-Z0-9]|CAS)[-A-Z0-9]+)(?=\b)/);return r?r[1].trim():""},j=e=>e?"string"!==typeof e?String(e):e.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():"",S=(e,t)=>{const r=j(e.caseNumber);if(r)return r;const n=d[t];return n||(N(e.result)||"")},A=(t||[]).filter(e=>{if(!b)return!0;const r=b.toLowerCase(),n=String(e.client||"").toLowerCase(),a=String(e.caregiver||"").toLowerCase(),s="string"===typeof e.caseNumber?e.caseNumber.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():e.caseNumber||"",o=String(s).toLowerCase(),c=(t||[]).indexOf(e),l=(d&&d[c]||N(e.result)||"").toLowerCase();return n.includes(r)||a.includes(r)||o.includes(r)||l.includes(r)});return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex items-center justify-between gap-4 mb-4",children:[(0,o.jsxs)("div",{className:"flex gap-3",children:[(0,o.jsx)("button",{className:"bg-gray-300 text-gray-800 px-6 py-2 rounded font-semibold hover:bg-gray-400",onClick:()=>{try{h()}catch{}try{f()}catch{}return"function"===typeof i?i():"function"===typeof c?c():void console.warn("BCASPanel: no onClear/onRecon callback provided.")},children:"Clear Results"}),(0,o.jsx)("button",{className:"bg-gray-300 text-gray-800 px-6 py-2 rounded font-semibold hover:bg-gray-400",onClick:async()=>{try{if("function"===typeof u)return void await u(t);if("function"===typeof l)return void await l(t)}catch(o){console.error("Parent export callback failed, falling back to client export:",o)}const e=new Set(["date","Date","service_date","SERVICE_DATE"]),n=(t||[]).map((t,r)=>{const n={};null!=t.client&&(n.Client=t.client);const a=Array.isArray(t.caregivers)?t.caregivers.join(", "):t.caregiver;if(null!=a&&(n.Caregiver=a),null!=t.caseNumber){const e="string"===typeof t.caseNumber?t.caseNumber.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():t.caseNumber;n.Case_Number=e}if(null!=t.result){const e=d&&d[r]||N(t.result);n.Result=e||"",!n.Case_Number&&e&&(n.Case_Number=e)}return Object.keys(t||{}).forEach(r=>{if(e.has(r))return;if("client"===r||"caregiver"===r||"caregivers"===r||"caseNumber"===r||"result"===r)return;const a=t[r];n[r]=Array.isArray(a)?a.join(", "):a}),n}),a=Array.from(n.reduce((e,t)=>(Object.keys(t).forEach(t=>e.add(t)),e),new Set)),s=n;try{const e=await r.e(287).then(r.t.bind(r,287,23)),t=e&&e.default?e.default:e,n=await t.fromBlankAsync(),o=n.sheet("Sheet1");o&&o.name("BCAS");const c=n.sheet("BCAS"),l=a.length?a:["Client","Caregiver","Case_Number","Result"];c.cell(1,1).value([l]),c.range(1,1,1,l.length).style({bold:!0,fill:"DDDDDD",horizontalAlignment:"center"}),s.forEach((e,t)=>{const r=t+2;l.forEach((t,n)=>c.cell(r,n+1).value(null==e[t]?"":e[t]))});const i=(s.length||0)+1,u=l.length;c.range(1,1,i,u).style("border","thin");try{c.freezePanes(1,0)}catch{}for(let r=0;r<l.length;r++){const e=l[r];let t=String(e).length;s.forEach(r=>{const n=String(null==r[e]?"":r[e]);t=Math.max(t,n.length)}),c.column(r+1).width(Math.min(60,t+2))}const d=await n.outputAsync(),m=URL.createObjectURL(d),h=document.createElement("a");return h.href=m,h.download="CaseConBCAS.xlsx",document.body.appendChild(h),h.click(),document.body.removeChild(h),void URL.revokeObjectURL(m)}catch(o){try{const e=await r.e(238).then(r.bind(r,238)),t=e&&e.default?e.default:e,n=t.utils.book_new(),o=t.utils.json_to_sheet(s),c=a;o["!cols"]=c.map(e=>{const t=String(e).length,r=s.reduce((t,r)=>Math.max(t,String(null==r[e]?"":r[e]).length),0);return{wch:Math.min(60,Math.max(t,r)+2)}}),t.utils.book_append_sheet(n,o,"BCAS"),t.writeFile(n,"CaseConBCAS.xlsx")}catch(c){console.error("BCAS export failed",c)}}},children:"Export"})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("input",{ref:p,type:"text",value:b,onChange:e=>{x(e.target.value),y&&w(null)},placeholder:"Search client, caregiver, case #...",className:"border rounded px-3 py-2 text-sm w-64 focus:outline-none focus:ring-2 "+("nomatch"===y?"border-red-400 bg-red-50 focus:ring-red-400":"focus:ring-blue-400"),onPaste:e=>{try{e.preventDefault();const r=(e.clipboardData||window.clipboardData).getData("text");if(!r)return;const n=N(r);if(!n)return C.current&&clearTimeout(C.current),w("nomatch"),void(C.current=setTimeout(()=>w(null),2e3));x(n);const a=(t||[]).findIndex((e,t)=>j(S(e,t)).toLowerCase()===n.toLowerCase());if(a>=0){m(a,n);try{const e=j(S(t[a],a)),r=e&&n&&e.toLowerCase()===n.toLowerCase();g(a,{parsedCase:n,matched:r,timestamp:(new Date).toISOString()})}catch{}setTimeout(()=>{x(""),y&&w(null),p.current&&p.current.blur()},0)}else C.current&&clearTimeout(C.current),w("nomatch"),C.current=setTimeout(()=>w(null),2e3)}catch{}}}),"nomatch"===y?(0,o.jsx)("span",{className:"text-xs text-red-600",children:"No matching case found"}):null,b?(0,o.jsx)("button",{onClick:()=>x(""),className:"text-sm text-gray-600 hover:text-gray-800 underline",title:"Clear search",children:"Clear"}):null]})]}),(0,o.jsx)("div",{className:"overflow-x-auto border rounded bg-white mb-2 output-scroll",children:(0,o.jsxs)("table",{className:"min-w-full text-sm",children:[(0,o.jsx)("thead",{className:"bg-gray-200",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Line #"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Client"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Caregiver"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Case #"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Result"})]})}),(0,o.jsx)("tbody",{children:A.map((e,r)=>{const n=(t||[]).indexOf(e);return(0,o.jsxs)("tr",{children:[(0,o.jsx)(a.A,{children:e.line||n+1}),(0,o.jsx)(a.A,{children:e.client}),(0,o.jsx)(a.A,{children:e.caregiver}),(0,o.jsx)(a.A,{children:"string"===typeof e.caseNumber?e.caseNumber.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():e.caseNumber||d[n]||N(e.result)||""}),(0,o.jsxs)("td",{className:"p-2",children:[(0,o.jsx)("div",{role:"textbox",contentEditable:!0,suppressContentEditableWarning:!0,onPaste:t=>{t.preventDefault();const r=(t.clipboardData||window.clipboardData).getData("text");if(!r)return;const a=N(r);if(a){t.currentTarget&&(t.currentTarget.textContent=a),m(n,a);try{const t=j(S(e,n)),r=t&&a&&t.toLowerCase()===a.toLowerCase();g(n,{parsedCase:a,matched:r,timestamp:(new Date).toISOString()})}catch{}}},onKeyDown:async t=>{try{if(!((t.ctrlKey||t.metaKey)&&("v"===t.key||"V"===t.key)))return;if(t.preventDefault(),navigator.clipboard&&navigator.clipboard.readText){const r=await navigator.clipboard.readText();if(!r)return;const a=N(r);if(!a)return;t.currentTarget&&(t.currentTarget.textContent=a),m(n,a);try{const t=j(S(e,n)),r=t&&a&&a.toLowerCase()===t.toLowerCase();g(n,{parsedCase:a,matched:r,timestamp:(new Date).toISOString()})}catch{}}}catch{}},onFocus:e=>v(e.currentTarget),onClick:e=>v(e.currentTarget),className:`min-w-[160px] px-2 py-1 border rounded focus:outline-none focus:ring-2 ${(()=>{const t=S(e,n),r=d&&d[n]||N(e.result)||"",a=t.toLowerCase(),s=r.toLowerCase();return s&&a&&s===a?"bg-green-50 border-green-400 focus:ring-green-300":s&&a&&s!==a?"bg-red-50 border-red-400 focus:ring-red-300":"focus:ring-orange-400"})()}`,children:d&&d[n]||N(e.result)||""}),(()=>{const t=S(e,n),r=d&&d[n]||N(e.result)||"",a=t.toLowerCase(),s=r.toLowerCase();return s&&a&&s!==a?(0,o.jsx)("div",{className:"mt-1 text-xs font-semibold text-red-700",children:"Case number mismatch. Please rectify in JOVIE."}):null})()]})]},r)})})]})})]})}}}]);
//# sourceMappingURL=518.aed7a32b.chunk.js.map
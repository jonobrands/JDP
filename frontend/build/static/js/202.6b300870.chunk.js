"use strict";(self.webpackChunkcasecon_frontend=self.webpackChunkcasecon_frontend||[]).push([[202],{821:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(43),s=r(339),a=r(464),c=r(526),i=r(326),l=r(534),o=r(579);const u=function(e){let{rows:t=[],onArchive:u,onExport:d}=e;const h=(0,a.A)(e=>e.editedResults),m=(0,a.A)(e=>e.setEditedResult),[g,b]=((0,a.A)(e=>e.clearEditedResults),(0,n.useState)("")),f=(0,n.useRef)(null),x=(0,n.useRef)(null),[p,C]=(0,n.useState)(null),y=(0,n.useRef)({}),[N,j]=(0,n.useState)(null),v=(0,n.useRef)(null),w=(0,c.Q)(e=>e.editedValues),A=(0,c.Q)(e=>e.deviationMessages),E=(0,i.A)(e=>e.confirmations),k=(0,l.A)(e=>e.debugLogs),R=(0,l.A)(e=>e.toggleDebugLogs);try{if(k){const e=Array.isArray(t)?t.length:0;if(e>=0){const r=(t||[]).slice(0,Math.min(3,e)).map((e,t)=>({i:t,caseNumber:e&&e.caseNumber,timeChecked:e&&e.timeChecked,result:e&&e.result}));console.log("[Recon][mount] rows length:",e,"peek:",r)}if(A){const e=Object.keys(A);console.log("[Recon][mount] timeckDeviationMessages keys:",e.slice(0,10))}}}catch{}const S=(e,t,r)=>{let n=parseInt(e,10);const s=parseInt(t,10)||0,a=(r||"").toLowerCase();return"pm"===a&&12!==n&&(n+=12),"am"===a&&12===n&&(n=0),60*n+s},M=e=>{if(!e||"string"!==typeof e)return null;const t=String(e).trim();let r=t.match(/\b(\d{1,2})(?::(\d{2}))?\s*([ap]m)\b\s*[-\u2013]\s*\b(\d{1,2})(?::(\d{2}))?\s*([ap]m)\b/i);if(r){var n,s;const e=S(r[1],null!==(n=r[2])&&void 0!==n?n:"00",r[3]);let t=S(r[4],null!==(s=r[5])&&void 0!==s?s:"00",r[6]);return t<=e&&(t+=1440),{start:e,end:t}}if(r=t.match(/\b(\d{1,2}):(\d{2})\b\s*[-\u2013]\s*\b(\d{1,2}):(\d{2})\b/),r){const e=(e,t)=>60*Math.min(23,Math.max(0,parseInt(e,10)))+Math.min(59,Math.max(0,parseInt(t,10))),t=e(r[1],r[2]);let n=e(r[3],r[4]);return n<=t&&(n+=1440),{start:t,end:n}}return null},T=e=>{const t=Math.abs(e),r=Math.floor(t/60),n=t%60;return r>0?`${r}h ${n}m`:`${n}m`},D=(e,t)=>{for(const r of t)if(e&&Object.prototype.hasOwnProperty.call(e,r)&&null!=e[r]&&""!==e[r])return e[r]},_=(e,t)=>{let r=A&&A[e]||"";if(!r)try{const n=(e=>{if(!e)return"";const t=D(e,["JOVIE_Time","jovie_time","timeRange","timerange","TIME_RANGE","TIME","time","Time"]);if(t)return t;const r=D(e,["start_time","startTime","START_TIME","Start_Time"]),n=D(e,["end_time","endTime","END_TIME","End_Time"]);return r&&n?`${r} - ${n}`:""})(t),s=((e,t)=>{const r=w&&w[e]||"";return r||t.result||t.timeChecked||""})(e,t);(n||s)&&(r=((e,t)=>{const r=M(e),n=M(t);if(!r||!n)return"";const s=n.start-r.start,a=n.end-r.end;if(0===s&&0===a)return"YES";const c=[];return s<0&&c.push(`Arrived early ${T(s)}`),s>0&&c.push(`Arrived late ${T(s)}`),a<0&&c.push(`Left early ${T(a)}`),a>0&&c.push(`Left late ${T(a)}`),Math.abs(s)>60||Math.abs(a)>60?`More than hour deviation: ${c.join(", ")}`:c.join(", ")})(n,s))}catch{}r&&"object"===typeof r&&Object.prototype.hasOwnProperty.call(r,"badge")&&(r=r.badge);try{k&&e<5&&console.log("[Recon][getBadge]",{idx:e,badge:r})}catch{}return r||""},O=e=>{if("string"!==typeof e)return"";const t=e.match(/BUC\s*Case\s*Number\s*:\s*([A-Z0-9-]+)/i);if(t)return t[1].trim();const r=e.match(/(?:^|\s)((?:00[a-zA-Z0-9]|CAS)[-A-Z0-9]+)(?=\b)/);return r?r[1].trim():""},$=e=>e?"string"!==typeof e?String(e):e.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():"",L=(t||[]).filter(e=>{if(!g)return!0;const r=g.toLowerCase(),n=String(e.client||"").toLowerCase(),s=String(e.caregiver||"").toLowerCase(),a="string"===typeof e.caseNumber?e.caseNumber.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():e.caseNumber||"",c=String(a).toLowerCase(),i=(t||[]).indexOf(e),l=(h&&h[i]||O(e.result)||"").toLowerCase();return n.includes(r)||s.includes(r)||c.includes(r)||l.includes(r)});return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("input",{ref:f,type:"text",value:g,onChange:e=>{b(e.target.value),p&&C(null)},placeholder:"Search client, caregiver, case #...",className:"border rounded px-3 py-2 text-sm w-64 focus:outline-none focus:ring-2 "+("nomatch"===p?"border-red-400 bg-red-50 focus:ring-red-400":"focus:ring-blue-400"),onPaste:e=>{try{const r=(e.clipboardData||window.clipboardData).getData("text");if(!r)return;e.preventDefault();const n=O(r);if(!n)return;b(n);const s=(t||[]).findIndex((e,t)=>$(((e,t)=>{const r=$(e.caseNumber);if(r)return r;return h[t]||O(e.result)||""})(e,t)).toLowerCase()===n.toLowerCase());s>=0?(m(s,n),setTimeout(()=>{b(""),p&&C(null),f.current&&f.current.blur()},0),(e=>{try{v.current&&clearTimeout(v.current),j(e),v.current=setTimeout(()=>j(null),1800)}catch{}})(`Assigned to row ${s+1}`)):(x.current&&clearTimeout(x.current),C("nomatch"),x.current=setTimeout(()=>C(null),2e3))}catch{}}}),"nomatch"===p?(0,o.jsx)("span",{className:"text-xs text-red-600",children:"No matching case found"}):null,g?(0,o.jsx)("button",{onClick:()=>b(""),className:"text-sm text-gray-600 hover:text-gray-800 underline",title:"Clear search",children:"Clear"}):null,(0,o.jsxs)("label",{className:"flex items-center gap-1 text-xs text-gray-600 cursor-pointer select-none",children:[(0,o.jsx)("input",{type:"checkbox",checked:!!k,onChange:R}),"Debug"]})]}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("button",{onClick:async()=>{try{if("function"===typeof d)return void await d(t)}catch(c){console.error("Parent export callback failed, falling back to client export:",c)}const e=new Set(["date","Date","service_date","SERVICE_DATE"]),n=(t||[]).map((t,r)=>{const n={};null!=t.client&&(n.Client=t.client);const s=Array.isArray(t.caregivers)?t.caregivers.join(", "):t.caregiver;if(null!=s&&(n.Caregiver=s),null!=t.caseNumber){const e="string"===typeof t.caseNumber?t.caseNumber.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():t.caseNumber;n.Case_Number=e}if(null!=t.result){const e=h&&h[r]||O(t.result);n.Result=e||"",!n.Case_Number&&e&&(n.Case_Number=e)}n.Time=_(r,t);const a=E&&E[r];return n.Status=a&&a.matched?"Checked":"Pending",Object.keys(t||{}).forEach(r=>{if(e.has(r))return;if("client"===r||"caregiver"===r||"caregivers"===r||"caseNumber"===r||"result"===r||"time"===r||"timeChecked"===r||"timeRange"===r)return;const s=t[r];n[r]=Array.isArray(s)?s.join(", "):s}),n}),s=Array.from(n.reduce((e,t)=>(Object.keys(t).forEach(t=>e.add(t)),e),new Set)),a=n;try{const e=await r.e(287).then(r.t.bind(r,287,23)),t=e&&e.default?e.default:e,n=await t.fromBlankAsync(),c=n.sheet("Sheet1");c&&c.name("RECON");const i=n.sheet("RECON"),l=s.length?s:["Client","Caregiver","Case_Number","Result"];i.cell(1,1).value([l]),i.range(1,1,1,l.length).style({bold:!0,fill:"DDDDDD",horizontalAlignment:"center"}),a.forEach((e,t)=>{const r=t+2;l.forEach((t,n)=>i.cell(r,n+1).value(null==e[t]?"":e[t]))});const o=(a.length||0)+1,u=l.length;i.range(1,1,o,u).style("border","thin");try{i.freezePanes(1,0)}catch{}for(let r=0;r<l.length;r++){const e=l[r];let t=String(e).length;a.forEach(r=>{const n=String(null==r[e]?"":r[e]);t=Math.max(t,n.length)}),i.column(r+1).width(Math.min(60,t+2))}const d=await n.outputAsync(),h=URL.createObjectURL(d),m=document.createElement("a");return m.href=h,m.download="CaseConRECON.xlsx",document.body.appendChild(m),m.click(),document.body.removeChild(m),void URL.revokeObjectURL(h)}catch(c){try{const e=await r.e(238).then(r.bind(r,238)),t=e&&e.default?e.default:e,n=t.utils.book_new(),c=t.utils.json_to_sheet(a),i=s;c["!cols"]=i.map(e=>{const t=String(e).length,r=a.reduce((t,r)=>Math.max(t,String(null==r[e]?"":r[e]).length),0);return{wch:Math.min(60,Math.max(t,r)+2)}}),t.utils.book_append_sheet(n,c,"RECON"),t.writeFile(n,"CaseConRECON.xlsx")}catch(i){console.error("RECON export failed",i)}}},className:"px-2 py-1 text-sm bg-blue-600 text-white rounded",children:"Export"}),(0,o.jsx)("button",{onClick:async()=>{try{if("function"===typeof u)return await u(t);alert("Archive feature coming soon!")}catch{}},className:"px-2 py-1 text-sm bg-gray-600 text-white rounded",children:"Archive"})]})]}),(0,o.jsx)("div",{className:"overflow-x-auto border rounded bg-white mb-2 output-scroll",children:(0,o.jsxs)("table",{className:"min-w-full text-sm",children:[(0,o.jsx)("thead",{className:"bg-gray-200",children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{className:"p-2 border font-bold",children:"#"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Client"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Caregiver"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Case Number"}),(0,o.jsx)("th",{className:"p-2 border font-bold w-64",children:"Time"}),(0,o.jsx)("th",{className:"p-2 border font-bold",children:"Status"})]})}),(0,o.jsx)("tbody",{children:L.map((e,r)=>{const n=(t||[]).indexOf(e),a="string"===typeof e.caseNumber?e.caseNumber.replace(/\s*(?:Date:|ESTCaregiver:).*$/i,"").trim():null!=e.caseNumber&&""!==e.caseNumber?e.caseNumber:h&&h[n]||O(e.result)||"",c=_(n,e),i=c||e.timeChecked||"";try{k&&r<5&&console.log("[Recon][render]",{idx:r,originalIndex:n,caseNumber:a,badge:c,timeChecked:e&&e.timeChecked,result:e&&e.result})}catch{}const l=E&&E[n],u=l&&l.matched?"Checked":"Pending",d=l&&l.matched?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800",m="string"===typeof i&&i.startsWith("More than hour deviation:")?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"font-medium",children:"More than hour deviation:"}),(0,o.jsx)("br",{}),(0,o.jsx)("span",{children:i.replace(/^More than hour deviation:\s*/,"")})]}):i,g=(()=>{const e=String(i||"").trim().toUpperCase();return"YES"===e?"bg-green-100 text-green-800":e.startsWith("MORE THAN HOUR DEVIATION")?"bg-red-100 text-red-800":e?"bg-orange-100 text-orange-800":""})();return(0,o.jsxs)("tr",{ref:e=>{e&&(y.current[n]=e)},children:[(0,o.jsx)(s.A,{children:e.line||n+1}),(0,o.jsx)(s.A,{children:e.client}),(0,o.jsx)(s.A,{children:e.caregiver}),(0,o.jsx)(s.A,{children:a}),(0,o.jsx)(s.A,{className:g,children:(0,o.jsx)("div",{className:"whitespace-normal break-words max-w-[16rem] text-[13px] leading-snug",children:m})}),(0,o.jsx)(s.A,{className:d,title:l?`Parsed: ${l.parsedCase||""}\n${l.matched?"Matched":"Not matched"}\n${l.timestamp?new Date(l.timestamp).toLocaleString():""}`:"",children:u})]},r)})})]})})]})}}}]);
//# sourceMappingURL=202.6b300870.chunk.js.map